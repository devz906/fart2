name: Titan Hollow Body
on: [push]
jobs:
  bake:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build Titan
        run: |
          SDK_PATH=$(xcrun --sdk iphoneos --show-sdk-path)
          mkdir -p Payload/Titan.app
          clang -target arm64-apple-ios17.0 -isysroot "$SDK_PATH" Sources/JIT/main.c -o Payload/Titan.app/Titan
          cat <<EOP > Payload/Titan.app/Info.plist
          <?xml version="1.0" encoding="UTF-8"?>
          <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
          <plist version="1.0"><dict>
              <key>CFBundleExecutable</key><string>Titan</string>
              <key>CFBundleIdentifier</key><string>com.titan.ios</string>
              <key>CFBundleName</key><string>Titan</string>
              <key>UIFileSharingEnabled</key><true/>
              <key>LSSupportsOpeningDocumentsInPlace</key><true/>
          </dict></plist>
          EOP
          ditto -c -k --sequesterRsrc --keepParent Payload Titan_Hollow.ipa
      - name: Upload
        uses: actions/upload-artifact@v4
        with:
          name: Titan-Hollow-IPA
          path: Titan_Hollow.ipa
